import Head from "next/head";
import React, {
  createContext,
  useState,
  useEffect,
  lazy,
  Suspense,
} from "react";
import Navbar from "@/components/_organisms/NavBar";
import { HeroProps } from "@/components/_organisms/Hero";
import { SocialLinks } from "@/components/_organisms/Footer";

type ThemeContextType = {
  darkMode: boolean;
  toggleTheme: () => void;
};

const ThemeContext = createContext<ThemeContextType>({
  darkMode: false,
  toggleTheme: () => {},
});

const Hero = lazy(() => import("@/components/_organisms/Hero"));
const Footer = lazy(() => import("@/components/_organisms/Footer"));

export default function Home() {
  const [darkMode, setDarkMode] = useState(false);
  const [data, setData] = useState<HeroProps | null>(null);
  const [socialLinks, setSocialLinks] = useState<SocialLinks | null>(null);
  const toggleTheme = () => {
    setDarkMode(!darkMode);
  };

  useEffect(() => {
    const fetchData = async () => {
      try {
        const response = await fetch("/api/allData");
        const result = await response.json();

        if (result) {
          setData(result?.info);
          setSocialLinks(result?.socialLinks);
        }
      } catch (error) {
        console.error("Error fetching data:", error);
      }
    };

    fetchData();
  }, []);

  return (
    <>
      <Head>
        <title>Avinash Rao | Portfolio</title>
        <meta name='description' content='Generated by create next app' />
        <meta name='viewport' content='width=device-width, initial-scale=1' />
        <link rel='icon' href='/favicon.ico' />
      </Head>
      <ThemeContext.Provider value={{ darkMode, toggleTheme }}>
        <main className={`${darkMode ? "bg-gray-800 p-4" : "p-4"}`}>
          <Navbar />
          <Suspense fallback={<div>Loading...</div>}>
            {data && <Hero info={data?.info} />}
          </Suspense>
          <Suspense fallback={<div>Loading...</div>}>
            {socialLinks && <Footer socialLinks={socialLinks} />}
          </Suspense>
        </main>
      </ThemeContext.Provider>
    </>
  );
}